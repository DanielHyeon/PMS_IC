# ì±—ë´‡ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

## ğŸ” ë¬¸ì œ ì§„ë‹¨

ì±—ë´‡ì—ì„œ "ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ AI ì„œë¹„ìŠ¤ê°€ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš© ë¶ˆê°€í•©ë‹ˆë‹¤" ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°, ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ì„¸ìš”:

```bash
./diagnose-chatbot.sh
```

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒì„ í™•ì¸í•©ë‹ˆë‹¤:
1. LLM ì„œë¹„ìŠ¤ ìƒíƒœ (í¬íŠ¸ 8000)
2. Mock ì„œë¹„ìŠ¤ ìƒíƒœ (í¬íŠ¸ 1080)
3. ë°±ì—”ë“œ ìƒíƒœ (í¬íŠ¸ 8080)
4. ê° ì„œë¹„ìŠ¤ì˜ API ì§ì ‘ í…ŒìŠ¤íŠ¸
5. Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ
6. ìµœê·¼ ë¡œê·¸ í™•ì¸

## ğŸ› ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²° ë°©ë²•

### ë¬¸ì œ 1: LLM ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:**
- LLM ì„œë¹„ìŠ¤ Health Check ì‹¤íŒ¨
- HTTP 500 ë˜ëŠ” ì—°ê²° ì˜¤ë¥˜

**í•´ê²° ë°©ë²•:**

```bash
# LLM ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps llm-service

# LLM ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
docker-compose logs llm-service | tail -50

# LLM ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart llm-service

# LLM ì„œë¹„ìŠ¤ ì§ì ‘ í…ŒìŠ¤íŠ¸
curl http://localhost:8000/health
```

**ì›ì¸:**
- ëª¨ë¸ íŒŒì¼ì´ ì—†ê±°ë‚˜ ê²½ë¡œê°€ ì˜ëª»ë¨
- ë©”ëª¨ë¦¬ ë¶€ì¡±
- í¬íŠ¸ ì¶©ëŒ

### ë¬¸ì œ 2: Mock ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:**
- Mock ì„œë¹„ìŠ¤ ì—°ê²° ì‹¤íŒ¨
- LLM ì„œë¹„ìŠ¤ ì‹¤íŒ¨ í›„ Mock ì„œë¹„ìŠ¤ë„ ì‹¤íŒ¨

**í•´ê²° ë°©ë²•:**

```bash
# Mock ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps ai-service

# Mock ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
docker-compose logs ai-service | tail -50

# Mock ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart ai-service

# Mock ì„œë¹„ìŠ¤ ì§ì ‘ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:1080/api/chat \
  -H "Content-Type: application/json" \
  -d '{"userId":"test","message":"ì•ˆë…•í•˜ì„¸ìš”","context":[]}'
```

**ì›ì¸:**
- Mock ì„œë¹„ìŠ¤ ì„¤ì • íŒŒì¼ ëˆ„ë½
- í¬íŠ¸ ì¶©ëŒ

### ë¬¸ì œ 3: ë°±ì—”ë“œê°€ LLM ì„œë¹„ìŠ¤ì— ì—°ê²°í•˜ì§€ ëª»í•¨

**ì¦ìƒ:**
- ë°±ì—”ë“œëŠ” ì •ìƒì´ì§€ë§Œ LLM ì„œë¹„ìŠ¤ í˜¸ì¶œ ì‹¤íŒ¨
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜

**í•´ê²° ë°©ë²•:**

```bash
# ë°±ì—”ë“œ ë¡œê·¸ì—ì„œ LLM ì„œë¹„ìŠ¤ í˜¸ì¶œ í™•ì¸
docker-compose logs backend | grep -i "llm\|mock\|fallback" | tail -20

# ë°±ì—”ë“œ ì¬ì‹œì‘
docker-compose restart backend

# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
docker-compose exec backend env | grep AI_TEAM
```

**í™•ì¸ ì‚¬í•­:**
- `AI_TEAM_API_URL`ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸ (ê¸°ë³¸ê°’: `http://localhost:8000`)
- Docker ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„œë¹„ìŠ¤ ì´ë¦„ ì‚¬ìš©: `http://llm-service:8000`
- ë¡œì»¬ ì‹¤í–‰ ì‹œ: `http://localhost:8000`

### ë¬¸ì œ 4: íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜

**ì¦ìƒ:**
- ìš”ì²­ì´ 30ì´ˆ ì´ìƒ ê±¸ë¦¼
- íƒ€ì„ì•„ì›ƒ ì˜ˆì™¸ ë°œìƒ

**í•´ê²° ë°©ë²•:**

```bash
# LLM ì„œë¹„ìŠ¤ ì‘ë‹µ ì‹œê°„ í™•ì¸
time curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"í…ŒìŠ¤íŠ¸","context":[],"retrieved_docs":[]}'

# íƒ€ì„ì•„ì›ƒ ì„¤ì • í™•ì¸ (application.yml)
# ai.service.timeout: 30000 (30ì´ˆ)
```

**ì¡°ì¹˜:**
- LLM ì„œë¹„ìŠ¤ê°€ ëŠë¦° ê²½ìš° íƒ€ì„ì•„ì›ƒ ì¦ê°€
- ë˜ëŠ” Mock ì„œë¹„ìŠ¤ë¡œ ë¹ ë¥´ê²Œ fallback

## ğŸ”§ ë‹¨ê³„ë³„ ë¬¸ì œ í•´ê²°

### 1ë‹¨ê³„: ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ í™•ì¸
docker-compose ps llm-service ai-service backend
```

### 2ë‹¨ê³„: ë¡œê·¸ í™•ì¸

```bash
# LLM ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs llm-service | tail -50

# ë°±ì—”ë“œ ë¡œê·¸ (ì±—ë´‡ ê´€ë ¨ë§Œ)
docker-compose logs backend | grep -i "chat\|llm\|mock" | tail -30

# ì „ì²´ ë¡œê·¸
docker-compose logs | tail -100
```

### 3ë‹¨ê³„: ì„œë¹„ìŠ¤ ì¬ì‹œì‘

```bash
# ê°œë³„ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart llm-service
docker-compose restart ai-service
docker-compose restart backend

# ì „ì²´ ì¬ì‹œì‘
docker-compose restart
```

### 4ë‹¨ê³„: ì™„ì „ ì¬ì‹œì‘ (ë°ì´í„° ìœ ì§€)

```bash
# ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose down

# ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f
```

### 5ë‹¨ê³„: ì™„ì „ ì´ˆê¸°í™” (ì£¼ì˜: ë°ì´í„° ì‚­ì œ)

```bash
# ëª¨ë“  ì»¨í…Œì´ë„ˆì™€ ë³¼ë¥¨ ì‚­ì œ
docker-compose down -v

# ì¬ì‹œì‘
docker-compose up -d
```

## ğŸ“Š ì„œë¹„ìŠ¤ë³„ í™•ì¸ ì‚¬í•­

### LLM ì„œë¹„ìŠ¤ (í¬íŠ¸ 8000)

```bash
# Health Check
curl http://localhost:8000/health

# ì˜ˆìƒ ì‘ë‹µ:
# {
#   "status": "healthy",
#   "model_loaded": true,
#   "rag_service_loaded": true,
#   "chat_workflow_loaded": true
# }

# ì§ì ‘ ì±„íŒ… í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ì•ˆë…•í•˜ì„¸ìš”",
    "context": [],
    "retrieved_docs": []
  }'
```

### Mock ì„œë¹„ìŠ¤ (í¬íŠ¸ 1080)

```bash
# Health Check
curl http://localhost:1080/health

# ì§ì ‘ ì±„íŒ… í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:1080/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "test",
    "message": "ì•ˆë…•í•˜ì„¸ìš”",
    "context": []
  }'
```

### ë°±ì—”ë“œ (í¬íŠ¸ 8080)

```bash
# Health Check
curl http://localhost:8080/actuator/health

# ë¡œê·¸ì¸ í›„ ì±—ë´‡ í…ŒìŠ¤íŠ¸
TOKEN=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@insure.com","password":"admin123"}' \
  | grep -o '"token":"[^"]*' | cut -d'"' -f4)

curl -X POST http://localhost:8080/api/chat/message \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"sessionId":null,"message":"ì•ˆë…•í•˜ì„¸ìš”"}'
```

## ğŸ” ë¡œê·¸ ë¶„ì„

### ë°±ì—”ë“œ ë¡œê·¸ì—ì„œ í™•ì¸í•  í‚¤ì›Œë“œ

```bash
# LLM ì„œë¹„ìŠ¤ í˜¸ì¶œ ì„±ê³µ
grep "Processing chat request" backend.log

# LLM ì„œë¹„ìŠ¤ ì‹¤íŒ¨ â†’ Mock ì„œë¹„ìŠ¤ë¡œ fallback
grep "falling back to mock" backend.log

# Mock ì„œë¹„ìŠ¤ë„ ì‹¤íŒ¨ â†’ ê¸°ë³¸ ì‘ë‹µ
grep "Mock AI service call failed" backend.log

# Circuit Breaker í™œì„±í™”
grep "Circuit breaker fallback triggered" backend.log
```

### LLM ì„œë¹„ìŠ¤ ë¡œê·¸ì—ì„œ í™•ì¸í•  í‚¤ì›Œë“œ

```bash
# ëª¨ë¸ ë¡œë“œ ì„±ê³µ
grep "Model loaded" llm-service.log

# ì±„íŒ… ìš”ì²­ ì²˜ë¦¬
grep "Processing chat" llm-service.log

# ì—ëŸ¬ ë°œìƒ
grep "Error\|Exception" llm-service.log
```

## ğŸš¨ ê¸´ê¸‰ ë³µêµ¬

ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°:

```bash
# 1. ëª¨ë“  ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose down

# 2. Docker ì‹œìŠ¤í…œ ì •ë¦¬ (ì„ íƒì‚¬í•­)
docker system prune -f

# 3. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose up -d

# 4. ë¡œê·¸ ëª¨ë‹ˆí„°ë§
docker-compose logs -f

# 5. ê° ì„œë¹„ìŠ¤ê°€ ì •ìƒ ì‹œì‘ë  ë•Œê¹Œì§€ ëŒ€ê¸° (ì•½ 1-2ë¶„)
```

## ğŸ“ ê°œì„  ì‚¬í•­

ìµœì‹  ì½”ë“œì—ëŠ” ë‹¤ìŒ ê°œì„  ì‚¬í•­ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **ë” ë‚˜ì€ ì—ëŸ¬ ì²˜ë¦¬**: Mock ì„œë¹„ìŠ¤ ì‹¤íŒ¨ ì‹œì—ë„ ê¸°ë³¸ ì‘ë‹µ ë°˜í™˜
2. **íƒ€ì„ì•„ì›ƒ ì„¤ì •**: Mock ì„œë¹„ìŠ¤ í˜¸ì¶œì— 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì¶”ê°€
3. **ìƒì„¸í•œ ë¡œê¹…**: ê° ë‹¨ê³„ì—ì„œ ìƒì„¸í•œ ë¡œê·¸ ì¶œë ¥
4. **í‚¤ì›Œë“œ ê¸°ë°˜ ê¸°ë³¸ ì‘ë‹µ**: ì„œë¹„ìŠ¤ ì‹¤íŒ¨ ì‹œì—ë„ ë§¥ë½ì— ë§ëŠ” ì‘ë‹µ ì œê³µ

## ğŸ’¡ ì˜ˆë°© ì¡°ì¹˜

1. **ì •ê¸°ì ì¸ Health Check**: ì£¼ê¸°ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
2. **ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§**: ë©”ëª¨ë¦¬ ë° CPU ì‚¬ìš©ëŸ‰ í™•ì¸
3. **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: ì—ëŸ¬ ë¡œê·¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸
4. **ë°±ì—…**: ì¤‘ìš”í•œ ì„¤ì • íŒŒì¼ ë°±ì—…

## ğŸ“ ì¶”ê°€ ë„ì›€

ë¬¸ì œê°€ ì§€ì†ë˜ë©´:
1. `diagnose-chatbot.sh` ì‹¤í–‰ ê²°ê³¼ í™•ì¸
2. ê´€ë ¨ ë¡œê·¸ íŒŒì¼ ìˆ˜ì§‘
3. Docker ë° ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸


