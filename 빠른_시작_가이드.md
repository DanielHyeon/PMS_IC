# RAG 시스템 빠른 시작 가이드

## 현재 상태

✅ **실행 중인 서비스:**
- PostgreSQL (포트 5433)
- Redis (포트 6379)
- ChromaDB (포트 8001) - RAG 벡터 DB
- LLM 서비스 (포트 8000) - Gemma 3 + RAG

⏳ **준비 중:**
- 백엔드 (빌드 중...)
- 프론트엔드

## 1단계: 백엔드 빌드 및 실행

백엔드가 빌드되면 자동으로 시작됩니다. 로그를 확인하세요:

```bash
# 빌드 진행 상황 확인
docker-compose logs -f backend

# 또는 직접 실행
cd /wp/PMS_IC
docker-compose up -d backend
```

## 2단계: 프론트엔드 실행

```bash
docker-compose up -d frontend
```

## 3단계: 서비스 접속

### 프론트엔드
- URL: http://localhost:5173
- 로그인: `admin@insure.com` / `admin123`

### API 문서
- Swagger UI: http://localhost:8080/swagger-ui.html

### ChromaDB (RAG)
- 포트: 8001
- 상태 확인: 프론트엔드에서 문서 업로드 후 채팅 테스트

## 4단계: RAG 시스템 테스트

### A. 문서 업로드

1. 프론트엔드 로그인
2. **프로젝트** 메뉴 선택
3. **단계별 산출물** 섹션
4. **파일 업로드** (PDF, Word, Excel)
   - 예: 프로젝트 계획서, 기술 명세서 등

### B. AI 챗봇으로 질문

1. 우측 하단 **AI 어시스턴트** 아이콘 클릭
2. 업로드한 문서 내용에 대해 질문
   - 예: "프로젝트 일정은 언제인가요?"
   - 예: "사용하는 기술 스택은?"

### C. RAG 작동 확인

백엔드 로그에서 RAG 동작 확인:

```bash
docker-compose logs backend | grep "RAG"
```

다음과 같은 로그가 표시되어야 합니다:
```
Deliverable indexed to RAG successfully: xxx-xxx
Retrieved 3 documents from RAG for message: ...
```

## 5단계: 수동 RAG 테스트 (선택사항)

### ChromaDB 통계 확인
```bash
curl http://localhost:8000/api/documents/stats
```

### 문서 검색 테스트
```bash
curl -X POST http://localhost:8000/api/documents/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "프로젝트 일정",
    "top_k": 3
  }'
```

### 테스트 문서 인덱싱
```bash
curl -X POST http://localhost:8000/api/documents \
  -H "Content-Type: application/json" \
  -d '{
    "documents": [{
      "id": "test-1",
      "content": "PMS 프로젝트는 2024년 1월에 시작되었습니다.",
      "metadata": {"source": "test"}
    }]
  }'
```

## 문제 해결

### 백엔드가 시작되지 않음

```bash
# 로그 확인
docker-compose logs backend

# 재시작
docker-compose restart backend
```

### RAG 검색이 동작하지 않음

```bash
# LLM 서비스 로그 확인
docker-compose logs llm-service | grep "RAG"

# ChromaDB 연결 확인
curl http://localhost:8000/health
# 응답: {"status":"healthy","model_loaded":false,"rag_service_loaded":true}
```

### 문서 인덱싱 실패

```bash
# 백엔드 로그에서 에러 확인
docker-compose logs backend | grep "Error indexing"

# LLM 서비스 로그 확인
docker-compose logs llm-service | tail -50
```

## 전체 시스템 재시작

문제가 발생하면 전체 시스템을 재시작하세요:

```bash
cd /wp/PMS_IC

# 모든 서비스 중지
docker-compose down

# 모든 서비스 시작
docker-compose up -d

# 로그 모니터링
docker-compose logs -f
```

## 추가 자료

- **[RAG_시스템_가이드.md](./RAG_시스템_가이드.md)** - 상세 가이드
- **[test-rag-system.sh](./test-rag-system.sh)** - 자동 테스트 스크립트
  ```bash
  ./test-rag-system.sh
  ```

---

**도움이 필요하면:**
1. 로그 확인: `docker-compose logs -f`
2. 서비스 상태: `docker-compose ps`
3. 헬스체크: `curl http://localhost:8000/health`
